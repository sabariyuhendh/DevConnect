generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String               @id @default(cuid())
  email               String               @unique
  emailVerified       Boolean              @default(false)
  firstName           String?
  lastName            String?
  username            String               @unique
  password            String?
  provider            String?
  bio                 String?
  title               String?
  company             String?
  location            String?
  website             String?
  github              String?
  linkedin            String?
  phone               String?
  profilePicture      String?
  coverPicture        String?
  timezone            String?              @default("UTC")
  locale              String?              @default("en")
  isActive            Boolean              @default(true)
  isVerified          Boolean              @default(false)
  isOnline            Boolean              @default(false)
  lastSeen            DateTime?
  profileViews        Int                  @default(0)
  preferences         Json?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  comments            Comment[]
  conversationMembers ConversationMember[]
  following           Follow[]             @relation("Following")
  followers           Follow[]             @relation("FollowedBy")
  createdGroups       Group[]
  groupMembers        GroupMember[]
  groupMessages       GroupMessage[]
  likes               Like[]               @relation("UserLikes")
  messages            Message[]
  messageReadStatus   MessageReadStatus[]
  posts               Post[]
  refreshTokens       RefreshToken[]
  sessions            Session[]
  // New user management relations
  connectionRequests  UserConnection[]     @relation("ConnectionRequester")
  connectionReceived  UserConnection[]     @relation("ConnectionAddressee")
  activityLogs        UserActivityLog[]
  reportsMade         UserReport[]         @relation("Reporter")
  reportsReceived     UserReport[]         @relation("Reported")
  skills              UserSkill[]
  experience          UserExperience[]

  @@index([email])
  @@index([username])
  @@index([isOnline])
  @@index([lastSeen])
  @@index([createdAt])
  @@index([isActive])
}

model Conversation {
  id        String               @id @default(cuid())
  type      ConversationType     @default(DIRECT)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  members   ConversationMember[]
  messages  Message[]

  @@index([type])
  @@index([updatedAt])
}

model ConversationMember {
  id             String       @id @default(cuid())
  conversationId String
  userId         String
  joinedAt       DateTime     @default(now())
  lastReadAt     DateTime?
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
  @@index([conversationId])
}

model Group {
  id          String         @id @default(cuid())
  name        String
  description String?
  isPublic    Boolean        @default(true)
  createdById String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  createdBy   User           @relation(fields: [createdById], references: [id], onDelete: Cascade)
  members     GroupMember[]
  messages    GroupMessage[]

  @@index([createdById])
  @@index([updatedAt])
}

model GroupMember {
  id       String    @id @default(cuid())
  groupId  String
  userId   String
  role     GroupRole @default(MEMBER)
  joinedAt DateTime  @default(now())
  group    Group     @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([userId])
  @@index([groupId])
}

model Message {
  id             String              @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime            @default(now())
  conversation   Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User                @relation(fields: [senderId], references: [id], onDelete: Cascade)
  readStatus     MessageReadStatus[]

  @@index([conversationId, createdAt])
  @@index([senderId, createdAt])
}

model MessageReadStatus {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  readAt    DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@index([userId])
  @@index([messageId])
}

model GroupMessage {
  id        String   @id @default(cuid())
  groupId   String
  senderId  String
  content   String
  createdAt DateTime @default(now())
  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  sender    User     @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([groupId, createdAt])
  @@index([senderId, createdAt])
}

model Post {
  id        String   @id @default(cuid())
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model Comment {
  id        String   @id @default(cuid())
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model Like {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation("UserLikes", fields: [userId], references: [id], onDelete: Cascade)
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  follower    User     @relation("Following", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("FollowedBy", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

enum ConversationType {
  DIRECT
}

enum GroupRole {
  OWNER
  ADMIN
  MEMBER
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
}

enum ProficiencyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model UserConnection {
  id          String           @id @default(cuid())
  requesterId String
  addresseeId String
  status      ConnectionStatus @default(PENDING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  requester   User             @relation("ConnectionRequester", fields: [requesterId], references: [id], onDelete: Cascade)
  addressee   User             @relation("ConnectionAddressee", fields: [addresseeId], references: [id], onDelete: Cascade)

  @@unique([requesterId, addresseeId])
  @@index([requesterId])
  @@index([addresseeId])
  @@index([status])
}

model UserActivityLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  details   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([action])
}

model UserReport {
  id          String       @id @default(cuid())
  reporterId  String
  reportedId  String
  reason      String
  description String?
  status      ReportStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  reporter    User         @relation("Reporter", fields: [reporterId], references: [id], onDelete: Cascade)
  reported    User         @relation("Reported", fields: [reportedId], references: [id], onDelete: Cascade)

  @@index([reporterId])
  @@index([reportedId])
  @@index([status])
  @@index([createdAt])
}

model UserSkill {
  id               String            @id @default(cuid())
  userId           String
  skillName        String
  proficiencyLevel ProficiencyLevel?
  yearsExperience  Int?
  createdAt        DateTime          @default(now())
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([skillName])
}

model UserExperience {
  id          String    @id @default(cuid())
  userId      String
  company     String
  position    String
  description String?
  startDate   DateTime?
  endDate     DateTime?
  isCurrent   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isCurrent])
}
